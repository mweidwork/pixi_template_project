name: CI-Pipeline

# Run on pushes to main branch
on:
    pull_request:
    push:
        branches: [main]

# Avoid overlapping runs
concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

# Action can only read repository contents
permissions:
    contents: read

# Define action jobs
jobs:
    # Run pre-commit checks again
    pre-commit-checks:
        name: Pre-commit Checks
        runs-on: ubuntu-latest
        timeout-minutes: 30

        # Steps to execute
        steps:
            - name: Checkout
            uses: actions/checkout@v5   # https://github.com/actions/checkout
            with:
                fetch-depth: 0  # Fetch all history for accurate pre-commit checks
            - name: Set up pixi environment
            uses: prefix-dev/setup-pixi@v0.9.3
            with:
                pixi-version: v0.59.0
                cache: true
                environments: default lint
            run: pixi run test
            - name: pre-commit
            run: pixi run pre-commit-run --color=always --show-diff-on-failure
